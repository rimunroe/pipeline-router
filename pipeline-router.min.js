!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports["pipeline-router"]=e():t["pipeline-router"]=e()}(this,function(){return function(t){function e(n){if(a[n])return a[n].exports;var r=a[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){var n=a(1);t.exports={name:"pipeline-router",factories:{router:n},startHook:function(t){t.router.start()}}},function(t,e,a){var n=a(2);t.exports=function(t){return function(e){t.router=new n;var a=(null!=e.routes?e.routes:{},e.routes),r="location",i={actions:{navigate:function(t,e){this.update({page:t,params:e})}}},o="navigate",u=function(t){this.require(null!=t,'You must pass a "page" argument to "navigate"')},s="router",l={stores:{location:function(){var e=this.stores.location.get(),a=t.router.makeRouteIntoPath(e.page,e.params),n=window.location.pathname;t.router.areEquivalentPaths(n,a)||window.history.pushState({},e.page,a)}}},h={action:!0,store:!0,adapter:!0};null!=e.defaults&&(null!=e.defaults.action&&(e.defaults.action!==!1?(null!=e.defaults.action.name&&(o=e.defaults.action.name),null!=e.defaults.action.validator&&(u=e.defaults.action.validator)):h.action=!1),null!=e.defaults.store&&(e.defaults.store!==!1?(null!=e.defaults.store.name&&(r=e.defaults.store.name),null!=e.defaults.store.actions&&(i.actions=e.defaults.store.actions)):h.store=!1),null!=e.defaults.adapter&&(e.defaults.adapter!==!1?(null!=e.defaults.adapter.name&&(s=e.defaults.adapter.name),null!=e.defaults.adapter.actions&&(l.actions=e.defaults.adapter.actions)):h.adapter=!1)),h.action&&t.create.action(o,u),h.store&&t.create.store(r,i),h.adapter&&t.create.adapter(s,l);var c=function(a){_.isFunction(a.handler)||(a.handler=null!=e.defaults&&_.isFunction(e.defaults.handler)?e.defaults.handler:t.actions.navigate),_.forEach(a.children,c)};c(a),new t.router.Route(a)}}},function(t){function e(){"use strict";this._routes={};var t=this,e=function(t){return t.length>1&&"/"===t[t.length-1]?t.slice(0,t.length-1):t},a=function(t){var e,a=t.split("/"),n={};for(e=0;e<a.length;e++){var r=a[e];":"===r[0]&&(n[r.slice(1,r.length)]=e)}return n};this.Route=function u(e,n){this.path=null==e.path?"/":e.path,this.pattern=e.dynamic===!0?null!=e.pattern?e.pattern:/[a-zA-Z0-9\+\(\)\-\_]+/:null!=e.pattern?e.pattern:new RegExp(this.path);var r="/"===this.path||null==n;if(r)this.fullPath="/";else{var i="/"===n?"":"/";this.fullPath=n+i+this.path}this.name=e.name,this.handler=e.handler,this.children=[];var o=this;Array.isArray(e.children)&&e.children.forEach(function(t){o.children.push(new u(t,o.fullPath))}),this.params=a(this.fullPath),this.makePath=function(t){var e=this.fullPath.split("/");for(var a in this.params)e[this.params[a]]=t[a];return e.join("/")},t._routes[this.fullPath]=this};var n=function(t,e,a){var r=[];return e.pattern.test(t[0])&&r.push({route:e,depth:a}),e.children.forEach(function(e){if(e.pattern.test(t.slice(1,t.length))){var i=n(t.slice(1,t.length),e,a+1);i.forEach(function(t){r.push(t)})}}),r};this.findRouteByPath=function(t){var e;"/"!==t?(e=t.split("/"),e[0]="/"):e=[t];var a=n(e,this._routes["/"],0),r=a[0];return a.forEach(function(t){t.depth>r.depth&&(r=t)}),r.route};var r=function(t,e){if(t.name===e)return t;var a;for(a=0;a<t.children.length;a++){var n=r(t.children[a],e);if(null!=n)return n}return!1};this.findRouteByName=function(t){return r(this._routes["/"],t)},this.hitRoute=function(t){var e=this.findRouteByPath(t),a=t.split("/"),n={};for(var r in e.params)n[r]=a[e.params[r]];e.handler.call(null,e.name,n,t)},this.makeRouteIntoPath=function(t,e){var a=this.findRouteByName(t);return a.makePath(e)},this.areEquivalentPaths=function(t,a){return e(t)===e(a)};var i=function(){t.hitRoute(window.location.pathname)},o=function(){t.hitRoute(window.location.pathname)};this.start=function(){window.addEventListener("popstate",i),window.addEventListener("load",o),this.hitRoute(window.location.pathname)}}t.exports=e}])});